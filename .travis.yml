language: kotlin

jdk:
- oraclejdk8

stages:
- name: build
- name: deploy
  if: branch = master AND type == pull_request

before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"

jobs:
  include:
  - stage: build
    script:
    - "./gradlew clean build test"
    after_success:
    - bash <(curl -s https://codecov.io/bash)
    before_install:
    - chmod +x gradlew
    - chmod +x gradle/wrapper/gradle-wrapper.jar
  - stage: deploy
    script:
    - "./gradlew clean build test publish"
    after_success:
    - bash <(curl -s https://codecov.io/bash)
    before_install:
    - openssl aes-256-cbc -K $encrypted_959d8f6be2a5_key -iv $encrypted_959d8f6be2a5_iv -in secret.gpg.enc -out $SIGNING_FILE -d
    - chmod +x gradlew
    - chmod +x gradle/wrapper/gradle-wrapper.jar
    env: 
    - secure: Q4+qH0hMkcTR0WMqBaaWBxsWc6A9ATp0hisK08L/+wlKoR7dNXrEKr5mqo3DlCmahXYbBbsstW2LsJ/Al7wEcagjl3T+UOAUwkHa72mDbof00IJ1go3Mt9vhLj31pBzk664jVyP5gkqv4hiMhY2OiVtoHEt9It6jUHUbYUh+CB2Y9bWH6f0+kqMRxFghoGBrfSGcScxqT9zjFQXaiA9d1vJtOh9z896NTEXggZIuP+CqiYDTjJQAR09ahwvxgUHWS2iDB3Wj6q2f1/ckx0HFMVFgIieLlHbJpkMgswBC5p98dVXCHcoMkuT5fMMJzdyhoqfSt2QK7nEtuw1InU95bl5lK3Yy7CctF8DM87aJQHgOXwxxYbXCSh/Nfu4W9dakbGyKEWBII1CXExSfzJ3gAlpeeUeXUlfxVz+8y7/u7IDFXlmkt6VHr1LgvxcxEcn5rvxGFSSut8OL7bIkeHXvhlaWnUellvKZ0K6gHXtcs62LDLKP4jxi993qI+Nk5LnkNECYFP7OyWZul5reNYEDuqdVdFJ5EmljBpUjHr1RGG7SGgKVan+Szu5edw5inyP/C1YuRXjCklIz698h4HSPr2W+Cu6MeUKWoqRIGtseQtT89czxgxjN7h24rbVlIj5Y4UTkPdtWil4e+dGdJJBYpgamfdO0lrfaXlxjF25+Pe4=
    - secure: BtgJu70rYDUfrpOCFbH2mesMMgEFuuDSXLIjcZQMph7WXZsWiPQWN8c7AqMRkta+V9u6eflrxj8yEvCjpqqllcERZME4PAcUcgc1Scve3v49OBtyLaxCUlSbXLJ4N0F7MNUdi1CAD6GFk5ZT8fWrkhV/UU0zdVdFPx56oQewP9wP64noCfdiMYW5K2nYjSMuO5Pxru+rdoTfbtopCtnk/hA1LcDD2LlOp5iBumilOJPLelLj8+ilHUewZgzElSjK1zzuNMYAx1KEnExDWcbsdFP989sTq6NmeWghb7+c6GcseoVeG4ym01lALpXsAmhjTSugzb/Ro6nhx+iCUcblac9Qa4b8jyJwpg1CdUjfCY/YvDvQXXUXbQ7kHEZ+aTK1dscwZoS0Q3MOhHfi+zgm4PuiJVJLDp7+4jhsLOxfHhPzb8rnm15WP8IgKd06vzOC1YiQejcugP91CUw3NZk5/DzgYDuU3smgzVC/1VpIDTdMrcih/vdqjHVjC85QQZO6D04nXlKuHyu2X4lyebnIZOHNHCFKg3Iq9l40o/EqBqFpfiehJPIj5p+UJNfbt3EXcTnTBUZDW7NBE6ZgoWgt2JWJKalWTe6cCgCKpNVHbfUItBMm7y4sQLfO9tZNgcf64L9lFRxUw5sBWxoMUWDS7vz5HPeh32XsDF5FItgwdok=
    - secure: YREsKxLFekyk6bYydXqaoRMI5+23IK7m2UcKo87Jo8/5HQoBkcrauQrskdQSEC5/aZMkNVMOfnfGYiOUfkV4CqaGmyPKfpTF2HaGXz+hXA2pFV+2MQJuWpMinh+Wf2/OCPGrILw8wWDU4ieH6tO5atSp16DDrCG+feWG8VkmO0y5doo+Z/Ecas7IasfUsFyMFM7g6nxrQvR3DDbixmSnzq6lLSYJfBebuD2TRqgP3Z+5FvHAPb+s7m2E6dYHwq+iCVH0GpGy8MvliO1LCMHegJxm27scSh9lxTPp7CBkwMXmOXxBG6AFUB6DoeyuioXIWyAsHaJjRWZQMXugEhFyIuy2ZMMMSWr1hHsOBhteEF4A+xh/MsLkejQKVunt2j+a8ATBdo8uuPRUKf1ILQvXtssFfYjU82o6LSOShzSLHsHNlJI0aZNQEIqM1101cu7QUJdhe8NBhXrSIlaihEpkCWq+PGhovjza/4dTxr8OWSAtMmG9Cu8qpnwaw1Vc+OQzICXEi4QN8rbrYPoRIYxP37BQfKXHjmmxzV8XqBNz6MY+BwCCmnqyCJ/K7EgzqzCQEm/t/YZnUcnk6dNbeSwwB5luuNUnUK+4Lb5+gdPjMqAEd8OoE/q7WfsivgvKUXAbIKF2Kq4vIDq/xYVeKjDoBe68Tg4DKnkIY96MtZbiJu0=
    - secure: eEknzfMq0P5TG5/Y911AuIa/QnO/CPYLDo60bWBIYd2CXaDDCBxOSUQmz5r60YBQ5i2v4nCxSlfWMLerok5stgzUxOcTv+zZdyL7pT6EmONFg6JjwJsKgyZZXXJBjZg81h5YqRNx8xPNu/2JQQX3mbU36IE5cY9H0sTjoiALK8dyiFpJE/737FpdvPzIU+j7rhC4q/2qsOBhJCyHkjQShG86yQcOO+bTZUGkit2XE1LnjS+sN8UTPvsZ0qfuxl45p2GeS/LwQ7d4OJQoEsSSYjICINRWjrso6yyHD1aEF2Eu2taPoWrP2b7xJtQL3gjiVq2CPeNeVi8a2VXWa2JLZxzEsjHF0XV5BSZFsn/yxWmwuen2jh2vH2aqO0WqsVPBnRIixROy34skHZ0zT4vK4kBcc4bpC9H0FKp2KV9NP7N+6HUdlzACIjKPoVSB8JfIZ8N61oQ+74sEb4/gwC+r8Zz8b4QwkNCfDR8vXfkW8yGHvLlNWMAe8lGWfZ5gcAp2mc0G8c/o8cq0boetgkivHvz65DMRkQcbWYSYZAHf8mBOR+8DGjxZY93TUGUNBmLFw4V4yGuYMdbZnLUhvJzN7Sz4nfpKaTd884wmVQuS5VlQaNytTZU8XwYBFk2a0n6xmNP2Gt3SegzZpNiSQPXRQ7kEXC3w7qq7lYFJaPSjzZY=
    - secure: UJTrls4YsVyHr41ngGWZSlXuzsxSuHcZsYnHAfxzNg7IHM9o3jy4lPbZBCwHpGi1QIPi/ES3gAEhnTDSLzBPZTLbXrGI7Y+cQC1uViXBEGYJhrIy6l8Dhm8DsxdT13Q4WU2cfH7LD/iOA6BBE+K+4LZjNs3mJW8EevOwq8MzjqgtnYLXcaqwSqJkX5+HMzr6WM5S6TrfxxA0xARF+PqpmQmbyy2Iw0PE06BqSQENfILhRPxNwrpnruOfOduZ7iVYrUjXLVCeNMuXO6dhvxD8daQPNPFuHYM9MkwwhW1Zdt9FD7mmH2c5Bfllr4xnEdfdjcv5pDNujKXeJQWoyPHRYwf8f0G2hRFX/G5jSK6LLDbl4HINspxFMzTuGKiQcXbFieXPP33bbx2zm7fzfWIS0KwiYCDaZiX58NVVCV6srUGa87QCXhhhmA7DgLHJn/tzaMZfB2WX1uuQzmQA2Z4bRzO14+j2Cd9gL/mlGiiSyauD7w8KOrr29pkI6fuWvKts2KxIz59U75OXCQ8CyHh3lYWFFvdn+WYIsxbCdc+ea4uXz3Gr4txWaEM/1Tj1MNH0XkXSiRaTchPf/Xbpkb55g3N+XuvA8v7yPWf3d/e7Mix0GW/kKX58vklCx5sH2FUdFl7V26hR3Pz3ytVoDQhLH/bWP277KzkuFHjQcclZ280=
